<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ZH LinkedIn Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Nunito', sans-serif; }
    .hide-scrollbar::-webkit-scrollbar { display: none; }
  </style>
</head>
<body class="bg-stone-100 text-stone-800 min-h-screen">

  <div id="app" class="max-w-3xl mx-auto p-4 md:p-6 pb-24">
    <header class="flex justify-between items-center mb-8 pt-2">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center text-white font-bold shadow-lg shadow-blue-200">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg>
        </div>
        <h1 class="text-2xl font-extrabold text-stone-800 tracking-tight">LinkedIn Tracker</h1>
      </div>
      <div class="flex gap-2">
        <button onclick="exportData()" class="p-2 hover:bg-stone-200 rounded-lg text-stone-500 transition-all" title="Export Data">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
        </button>
        <button onclick="importData()" class="p-2 hover:bg-stone-200 rounded-lg text-stone-500 transition-all" title="Import Data">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
        </button>
      </div>
    </header>

    <div id="view-dashboard">
      <div class="grid grid-cols-3 gap-4 mb-8">
        <div class="bg-white p-5 rounded-2xl shadow-sm border border-stone-100">
          <div class="text-stone-400 text-xs font-bold uppercase tracking-wider mb-1">Total</div>
          <div class="text-3xl font-black text-stone-800" id="stat-total">0</div>
        </div>
        <div class="bg-white p-5 rounded-2xl shadow-sm border border-stone-100">
          <div class="text-stone-400 text-xs font-bold uppercase tracking-wider mb-1">In Progress</div>
          <div class="text-3xl font-black text-blue-500" id="stat-active">0</div>
        </div>
        <div class="bg-white p-5 rounded-2xl shadow-sm border border-stone-100">
          <div class="text-stone-400 text-xs font-bold uppercase tracking-wider mb-1">Completed</div>
          <div class="text-3xl font-black text-emerald-500" id="stat-completed">0</div>
        </div>
      </div>

      <div class="flex justify-between items-end mb-6">
        <h2 class="text-xl font-bold text-stone-700">Recent Videos</h2>
        <button onclick="createNewVideo()" class="bg-stone-900 hover:bg-black text-white px-5 py-2.5 rounded-xl font-bold shadow-lg shadow-stone-200 transform hover:scale-105 transition-all flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
          New Video
        </button>
      </div>

      <div id="video-list" class="space-y-3"></div>
    </div>

    <div id="view-workspace" class="hidden">
      <button onclick="switchView('dashboard')" class="mb-6 flex items-center text-stone-500 hover:text-stone-800 font-bold transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="mr-1"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
        Back to Dashboard
      </button>

      <div class="bg-white rounded-3xl shadow-xl shadow-stone-200/50 border border-stone-100 overflow-hidden">
        <div class="p-8 border-b border-stone-100">
          <div class="flex justify-between items-start gap-4">
            <div class="flex-1">
              <label class="block text-xs font-bold text-stone-400 uppercase tracking-wider mb-2">Video Title</label>
              <input type="text" id="active-title" 
                class="w-full text-2xl font-bold text-stone-800 bg-transparent border-none focus:ring-0 p-0 placeholder-stone-300" 
                placeholder="Untitled Video..."
                oninput="updateActiveVideoTitle(this.value)">
            </div>
            <button onclick="deleteActiveVideo()" class="text-stone-300 hover:text-rose-500 transition-colors p-2">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
            </button>
          </div>
          
          <div class="mt-6">
            <div class="flex justify-between text-sm font-bold text-stone-500 mb-2">
              <span id="progress-text">0% Complete</span>
              <span id="steps-text">0/14</span>
            </div>
            <div class="h-3 bg-stone-100 rounded-full overflow-hidden">
              <div id="progress-bar" class="h-full bg-blue-500 transition-all duration-500 ease-out rounded-full" style="width: 0%"></div>
            </div>
          </div>
        </div>

        <div class="p-8 bg-stone-50/50" id="steps-container"></div>
      </div>
    </div>
  </div>

  <script>
    const STORAGE_KEY = 'linkedin_tracker_data';
    
    // UPDATED STEPS based on 'LinkedIn-video-processing-table.md'
    const DEFAULT_WORKFLOW_GROUPS = [
      {
        title: "Descript",
        steps: [
          "Upload & Transcribe",
          "Add Captions",
          "Make Edits",
          "Download Edited File"
        ]
      },
      {
        title: "Canva",
        steps: [
          "Copy Template",
          "Add & Edit Video",
          "Download Final Video",
          "Create Thumbnail"
        ]
      },
      {
        title: "LinkedIn Post",
        steps: [
          "Copy Transcript to txt file",
          "Generate Captions",
          "Upload Video to LinkedIn",
          "Upload Thumbnail",
          "Draft Post Description",
          "Schedule Post"
        ]
      }
    ];

    let videos = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
    let currentVideoId = null;

    function init() { renderDashboard(); }

    function saveData() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(videos));
      updateStats();
    }

    function createNewVideo() {
      const newVideo = {
        id: Date.now().toString(),
        title: "",
        createdAt: new Date().toISOString(),
        completed: false,
        steps: {}
      };
      videos.unshift(newVideo);
      saveData();
      openVideo(newVideo.id);
    }

    function openVideo(id) {
      if(!id) return alert("Error: Video has no ID");
      
      currentVideoId = id;
      const video = videos.find(v => v.id === id);
      if(!video) return;

      document.getElementById('view-dashboard').classList.add('hidden');
      document.getElementById('view-workspace').classList.remove('hidden');
      
      document.getElementById('active-title').value = video.title || "";
      renderSteps(video);
      updateProgress(video);
      window.scrollTo(0, 0);
    }

    function switchView(viewName) {
      if (viewName === 'dashboard') {
        document.getElementById('view-workspace').classList.add('hidden');
        document.getElementById('view-dashboard').classList.remove('hidden');
        renderDashboard();
        currentVideoId = null;
      }
    }

    function updateActiveVideoTitle(newTitle) {
      const video = videos.find(v => v.id === currentVideoId);
      if (video) { video.title = newTitle; saveData(); }
    }

    function toggleStep(stepName) {
      const video = videos.find(v => v.id === currentVideoId);
      if (video) {
        video.steps[stepName] = !video.steps[stepName];
        
        const allSteps = getApplicableSteps(video);
        video.completed = allSteps.every(s => video.steps[s]);
        
        saveData();
        renderSteps(video);
        updateProgress(video);
      }
    }

    function deleteActiveVideo() {
      if(confirm('Delete this tracker?')) {
        videos = videos.filter(v => v.id !== currentVideoId);
        saveData();
        switchView('dashboard');
      }
    }

    function getApplicableSteps(video) {
       return DEFAULT_WORKFLOW_GROUPS.flatMap(g => g.steps);
    }

    function renderDashboard() {
      const list = document.getElementById('video-list');
      list.innerHTML = '';

      if (videos.length === 0) {
        list.innerHTML = `<div class="text-center py-12 bg-white rounded-2xl border border-stone-100 border-dashed text-stone-400 font-medium">No videos yet.</div>`;
      } else {
        videos.forEach(video => {
          const allSteps = getApplicableSteps(video);
          const doneCount = allSteps.filter(s => video.steps[s]).length;
          const pct = allSteps.length > 0 ? Math.round((doneCount / allSteps.length) * 100) : 0;

          const el = document.createElement('div');
          el.className = `bg-white p-4 rounded-xl shadow-sm border border-stone-100 hover:shadow-md transition-all cursor-pointer flex items-center justify-between group`;
          el.onclick = () => openVideo(video.id);
          el.innerHTML = `
            <div class="flex-1">
              <h3 class="font-bold text-stone-800 ${!video.title ? 'italic text-stone-400' : ''}">${video.title || 'Untitled Video'}</h3>
              <div class="text-xs text-stone-400 mt-1 flex items-center gap-2">
                <span>${new Date(video.createdAt).toLocaleDateString()}</span>
                <span class="w-1 h-1 bg-stone-300 rounded-full"></span>
                <span class="${pct === 100 ? 'text-emerald-500 font-bold' : 'text-stone-400'}">${pct}% Done</span>
              </div>
            </div>
            <div class="flex items-center gap-3">
               ${pct === 100 
                 ? `<span class="bg-emerald-100 text-emerald-700 px-3 py-1 rounded-full text-xs font-bold">Done</span>` 
                 : `<div class="w-16 h-2 bg-stone-100 rounded-full overflow-hidden"><div class="h-full bg-blue-500" style="width: ${pct}%"></div></div>`
               }
               <svg class="text-stone-300 group-hover:text-stone-600 transition-colors" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
            </div>
          `;
          list.appendChild(el);
        });
      }
      updateStats();
    }

    function renderSteps(video) {
      const container = document.getElementById('steps-container');
      container.innerHTML = '';
      
      DEFAULT_WORKFLOW_GROUPS.forEach(group => {
        const groupDiv = document.createElement('div');
        groupDiv.className = 'mb-8 last:mb-0';
        groupDiv.innerHTML = `<h4 class="text-sm font-extrabold text-stone-400 uppercase tracking-widest mb-4 ml-1">${group.title}</h4>`;
        const stepsList = document.createElement('div');
        stepsList.className = 'space-y-3';
        
        group.steps.forEach(step => {
          const isDone = video.steps ? video.steps[step] : false;
          const btn = document.createElement('div');
          btn.className = `flex items-center p-4 rounded-xl cursor-pointer border transition-all duration-200 group select-none ${isDone ? "bg-emerald-50 border-emerald-200" : "bg-white border-stone-200 hover:border-stone-300 hover:shadow-sm"}`;
          btn.onclick = () => toggleStep(step);
          btn.innerHTML = `
            <div class="w-6 h-6 rounded-lg border-2 flex items-center justify-center mr-4 transition-colors ${isDone ? 'bg-emerald-500 border-emerald-500' : 'border-stone-300 bg-stone-50 group-hover:border-stone-400'}">
              ${isDone ? '<svg class="text-white" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>' : ''}
            </div>
            <span class="font-medium ${isDone ? 'text-emerald-800 line-through decoration-emerald-300/50' : 'text-stone-700'}">${step}</span>
          `;
          stepsList.appendChild(btn);
        });
        groupDiv.appendChild(stepsList);
        container.appendChild(groupDiv);
      });
    }

    function updateStats() {
      const total = videos.length;
      const completed = videos.filter(v => v.completed).length;
      const active = total - completed;
      document.getElementById('stat-total').innerText = total;
      document.getElementById('stat-active').innerText = active;
      document.getElementById('stat-completed').innerText = completed;
    }

    function updateProgress(video) {
      const allSteps = getApplicableSteps(video);
      const doneCount = allSteps.filter(s => video.steps[s]).length;
      const pct = allSteps.length > 0 ? Math.round((doneCount / allSteps.length) * 100) : 0;
      
      document.getElementById('progress-bar').style.width = `${pct}%`;
      document.getElementById('progress-bar').className = `h-full transition-all duration-500 ease-out rounded-full ${pct === 100 ? 'bg-emerald-500' : 'bg-blue-500'}`;
      document.getElementById('progress-text').innerText = `${pct}% Complete`;
      document.getElementById('steps-text').innerText = `${doneCount}/${allSteps.length}`;
    }

    function exportData() {
      const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(videos));
      const a = document.createElement('a');
      a.href = dataStr; a.download = "linkedin-tracker-backup.json";
      document.body.appendChild(a); a.click(); a.remove();
    }

    function importData() {
      const input = document.createElement('input'); input.type = 'file';
      input.onchange = e => {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.readAsText(file, 'UTF-8');
        reader.onload = r => {
          try { 
            const rawData = JSON.parse(r.target.result);
            // Smart Fix: Ensure array & add IDs if missing
            let cleanData = Array.isArray(rawData) ? rawData : [rawData];
            cleanData = cleanData.map((v, idx) => {
              if (!v.id) v.id = 'imported_' + Date.now() + '_' + idx;
              if (!v.steps) v.steps = {};
              if (!v.title) v.title = "Untitled Import";
              if (!v.createdAt) v.createdAt = new Date().toISOString();
              return v;
            });

            videos = cleanData; 
            saveData(); 
            renderDashboard(); 
            alert(`Successfully imported ${videos.length} videos.`); 
          } catch(e) { 
            alert('Error reading file: ' + e); 
          }
        }
      }
      input.click();
    }
    init();
  </script>
</body>
</html>
